<div class="message-list-container">
  <!-- 空状態 -->
  @if (isEmpty()) {
    <div class="empty-state">
      <mat-icon>chat_bubble_outline</mat-icon>
      <p>まだメッセージがありません。</p>
      <p class="hint">下の入力欄からメッセージを送信してください。</p>
    </div>
  }

  <!-- メッセージ一覧 -->
  <div class="messages">
    @for (message of messages(); track message.id) {
      <mat-card [class]="getMessageClass(message)" class="message-card">
        <mat-card-header>
          <mat-card-title>{{ getSenderName(message) }}</mat-card-title>
          <mat-card-subtitle>{{ message.createdAt | date:'short' }}</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <div class="message-content" [innerHTML]="message.content"></div>
          
          <!-- 参照ソース表示 -->
          @if (message.sources && message.sources.length > 0) {
            <div class="sources">
              <h4>参照</h4>
              <mat-chip-set>
                @for (source of message.sources; track source.title) {
                  <mat-chip>
                    <mat-icon [fontIcon]="getSourceIcon(source.type)"></mat-icon>
                    {{ source.title }}
                  </mat-chip>
                }
              </mat-chip-set>
            </div>
          }
        </mat-card-content>
      </mat-card>
    }

    <!-- ストリーミング中のメッセージ -->
    @if (isStreaming()) {
      <mat-card class="message-card message-assistant streaming">
        <mat-card-header>
          <mat-card-title>アシスタント</mat-card-title>
          <mat-card-subtitle>応答を生成中...</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <div class="message-content" [innerHTML]="streamingContent()"></div>
          <mat-spinner diameter="20" class="streaming-spinner"></mat-spinner>
        </mat-card-content>
      </mat-card>
    }
  </div>
</div>
