# P0 Core Chat - E2E シナリオ (Manual)

PoC (P0) 環境における手動確認用の E2E シナリオです。
将来的にこれらのシナリオの一部は Playwright / Cypress 等で自動化されることを目指しますが、現状は手動での品質担保に利用してください。

## 前提
- **WSL2 (Ubuntu)** 環境上で `docker compose up` が正常に完了していること。
- ブラウザ (Chrome/Edge) で `http://localhost` にアクセス可能であること。
- DB は初期化済み (Alembic migration 適用済み) であること。

---

## シナリオ 1: 環境起動と基本疎通

### 手順
1. WSL ターミナルで `docker compose up --build -d` を実行。
2. Windows 側ブラウザで `http://localhost` にアクセス。
3. アプリケーションのトップページ（またはログイン画面）が表示されることを確認。

### 期待値
- 画面が真っ白にならず、Angular アプリがレンダリングされる。
- Console に深刻な JS エラーが出ていない。
- Nginx 経由で Frontend にアクセスできている。

---

## シナリオ 2: チャット機能 (Core Chat)

※ **注意**: OIDC プロバイダがモック、または実環境の設定が必要です。
IdP 連携が未設定の場合、このシナリオは実施不可能です（または Dev 用バイパスログインを使用）。

### 手順
1. ログインボタンを押下し、IdP 経由でログインする。
2. `/chat` 画面に遷移する。
3. チャット入力欄に「こんにちは、テストです」と入力し送信する。
4. ストリーミング応答が開始され、完了まで表示されることを待つ。

### 期待値
- メッセージが送信され、チャット履歴に追加される。
- 「考え中...」などのインジケータが表示された後、回答が表示される。
- 回答が Markdown として正しくレンダリングされている（太字、リストなど）。

---

## シナリオ 3: 管理者ナレッジ確認

### 手順
1. 初期管理者メールアドレス (`INITIAL_ADMIN_EMAIL` で設定されたアドレス) でログインする。
2. サイドメニューまたはヘッダーから `/knowledge` (または管理者メニュー) にアクセスする。
3. ナレッジ一覧画面が表示されることを確認する。

### 期待値
- アクセス権限エラー (403) にならず、画面が表示される。
- 登録済みのナレッジがあればリスト表示される。空の場合は Empty State が表示される。

---

## シナリオ 4: 設定変更の永続化

### 手順
1. `/settings` 画面にアクセスする。
2. 「テーマ」を「ダークモード」に変更する（または言語を「English」に変更）。
3. ページをリロードする。

### 期待値
- リロード後も変更した設定（ダークモード/英語など）が維持されている。
- User Settings API が正常に動作している。
