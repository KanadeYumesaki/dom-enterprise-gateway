# フロントエンド実装解説 (Task 7.1)

こんにちは！  
今回は、アプリの「入り口」と「外枠」を作りました。  
**「認証（ログイン）」** と **「メインレイアウト（ヘッダーやサイドバー）」** です。

これらは、どんなアプリを作るときでも最初に必要になる「土台」の部分です。

---

## 1. 今回やったこと

1.  **Angular Material の導入**
    *   Googleっぽい見た目にするためのUI部品セットを入れました。
2.  **ログイン機能の実装**
    *   ログイン画面 (`login-page`)
    *   ログイン後のコールバック画面 (`auth-callback`)
    *   番人 (`auth.guard`)
3.  **メインレイアウトの実装**
    *   ヘッダー (`header`)
    *   サイドバー (`sidebar`)
    *   全体枠 (`main-layout`)

---

## 2. ログインの流れ (Authentication Flow)

今回は **BFF (Backend For Frontend)** パターンを使っているため、フロントエンドは「バックエンドにお願いする」だけです。具体的な流れを見てみましょう。

### Step 1: ログイン画面 (/login)
- ユーザーが最初にアクセスします。
- **「ログインする」ボタン**: これを押すと、`AuthService.login()` が呼ばれます。
- 裏側では、あなたのブラウザをバックエンドの特別なURL (`/api/auth/login`) に移動させます。

### Step 2: 外部の認証画面
- Googleなどの認証プロバイダへ移動し、IDとパスワードを入れます。
- ここはアプリの外側の出来事です。

### Step 3: コールバック画面 (/auth/callback)
- 認証が終わると、アプリに戻ってきます。
- ここで **「ログイン処理中です...」** という画面が一瞬出ます。
- `AuthService.handleCallback()` が動き、バックエンドと「ちゃんとログインできた？」を確認します。
- 成功したら、メイン画面へ移動します。

---

## 3. 画面の守り神: Auth Guard

**`auth.guard.ts`** というファイルを作りました。  
これは、**「未ログインの人がチャット画面に入り込まないようにする番人」** です。

- もしログイン済みなら → 「どうぞ！」と通します。
- もし未ログインなら → 「ダメです、ログインしてください」とログイン画面へ強制送還します。

---

## 4. メインレイアウト (Application Shell)

ログインが成功した人だけが見られる「アプリの本体」です。  
3つの部品でできています。

1.  **Main Layout (`main-layout`)**: 全体の親玉です。ユーザー情報を管理し、子供たち（ヘッダーやサイドバー）に配ります。
2.  **Header (`header`)**: 画面上のバーです。アプリ名や、ログインユーザーの名前が出ています。
3.  **Sidebar (`sidebar`)**: 左側のメニューです。「チャット」や「設定」などの切り替えができます。
    *   面白い仕掛けとして、**「管理者 (admin)」しか見えないメニュー** (Knowledge) を作ってあります。これが **RBAC (権限管理)** の第一歩です！

---

## 5. 動かしてみよう！ (Try it out)

WSL2のターミナルで実行してください。

### 準備
```bash
cd ~/work/dom-enterprise-gateway/frontend
npm install
```

### 実行
```bash
npm start
```

ブラウザで `http://localhost:4200` を開いてみてください。
いきなりログイン画面に飛ばされたら大成功です！（番人が仕事をしている証拠です）

### 次回の予定
今はメニューをクリックしても「開発中 (WIP)」と表示されるだけですが、次回 (Task 7.2) いよいよ **「チャット画面」** そのものを作っていきます！お楽しみに！
