# DOM Enterprise Gateway – ヘルプセンター構成案
`help_content_outline.md`  
Version: 1.1 (PoC-P0 ベース, Ephemeral RAG + リサーチモード + 強制リセット反映)

---

## 1. はじめに

### 1.1 このシステムでできること
- エンタープライズ向けの LLM チャット支援
- 社内ナレッジ (RAG) を利用した質問回答
- 長期メモリ（過去セッション・決定事項）を活用した文脈保持
- リサーチモード（簡易エージェント）による高度な調査
- フィードバックを用いた自己改善と品質向上

### 1.2 画面構成の全体像
- チャット画面
- セッション一覧
- メモリ画面
- ナレッジ管理（管理者）
- 設定画面（ユーザー / 管理者）
- ヘルプセンター

---

## 2. チャットの基本的な使い方

### 2.1 新しいチャットを始める
- セッション一覧から「新しいチャット」をクリック
- タイトルは自動生成だが、後から変更可能（任意）

### 2.2 メッセージを送る
- 入力欄に日本語または英語で質問・相談内容を書く
- Enter で送信 / Ctrl+Enter で改行
- 送信後、数秒でストリーミング表示が始まる

### 2.3 回答フォーマット（IC-5 ライト）
- **Decision**: 結論
- **Why**: 理由・背景
- **Next 3 Actions**: 次にやるべき3ステップ
- 画面上では、それぞれが見出し付きのブロックとして表示される
- この構造により、「何をすべきか」「なぜそうなのか」が一目で分かる

### 2.4 サンプルプロンプトの活用
- 入力欄のプレースホルダに表示される例
- 画面上部の「テンプレート」エリアをクリックで挿入
- 自分なりのテンプレートを作るコツ

### 2.5 リサーチモード（高度リサーチ）の使い方
- 複雑な調査や比較検討をしたいときは、チャット入力欄付近の
  「高度リサーチモード」トグルを ON にする、または `/research` コマンドを利用
- リサーチモードでは、システムが内部で複数ステップ（情報収集 → 整理 → 統合）を行うため、
  通常より応答が少し遅くなることがある
- 応答の上部に「今回のリサーチステップ」の簡単な一覧（例: 検索1 / 検索2 / 統合）が表示される
- 通常モードとの差分:
  - 通常モード: 1 回の検索 + 回答
  - リサーチモード: 複数回の検索＋中間要約＋最終統合

---

## 3. ファイル添付とナレッジ登録

### 3.1 チャットでファイルを添付する（PoC）
- 添付ボタンの位置
- サポートする拡張子:
  - PDF / txt / md / docx / pptx / xlsx
- ファイル数とサイズ制限（デフォルト値）:
  - 1 回の送信で最大 10 ファイル
  - 1 ファイル最大 約 5MB、合計 約 15MB まで
- 制限を超えたときに出るエラーメッセージと対処法
  - ファイルを小さくする
  - 分割して複数回送信する

### 3.2 添付ファイルがどのように使われるか
- 添付されたファイルは、現在のセッション専用の「一時ナレッジ」として読み込まれる
- 内部では、ファイルのテキストが分割・ベクトル化され、
  **「Ephemeral RAG（セッション限定のベクトル検索）」** に登録される
- 質問に応じて、関連度の高い一部だけがコンテキストとして LLM に渡される
  （ファイル全文を毎回そのまま送るわけではない）
- PoC では長期ナレッジには自動登録されない
- セッション終了後または一定時間後に、この一時インデックスは削除される

### 3.3 ナレッジ登録（管理者向け / 将来機能概要）
- ナレッジ管理画面からファイルを登録
- RAG 用にどのように分割・保存されるかのイメージ
- 管理者に求められる注意点（機密情報・最新性など）

---

## 4. メモリと `/reset` の使い方

### 4.1 メモリの種類
- 短期記憶: 現在のチャット履歴（画面に見えている会話）
- StructuredMemory: ユーザー/プロジェクトの設定・プロフィール
- EpisodicMemory: セッション要約・決定事項のメモ（「この会話で何が決まったか」）

### 4.2 「保存して終了」と「保存せず終了」
- **保存して終了**:
  - 会話の要約と決定事項が長期メモリに保存
  - 次回チャットから参照される可能性がある
- **保存せず終了**:
  - 一時的な相談やテストに使う場合
  - 長期メモリには残らない

### 4.3 `/reset` の意味
- 現在のセッションを区切って、新しいセッションに切り替える
- 自動的に要約して EpisodicMemory へ保存を試みる
- 保存に失敗した場合はセッションを消さない（Reset インバリアント）
- エラーが繰り返し発生する場合、  
  「保存せずに新しいセッションを始める（強制リセット）」オプションが表示されることがある

### 4.4 メモリ画面から過去のメモを探す
- キーワード検索の使い方
- 検索結果（日時・要約・重要度）の見方
- 将来機能: 過去メモを現在のチャットに読み込むイメージ

---

## 5. 設定画面の使い方（ユーザー）

### 5.1 表示設定
- フォントサイズの変更（小 / 標準 / 大）
- テーマ（ライト / ダーク）の切り替え
- 変更は直ちに画面に反映され、次回ログイン時にも保持される

### 5.2 UI 言語設定
- 日本語 / 英語の切り替え
- PoC 時点では、基本的なメニューと主要画面が翻訳対象

### 5.3 LLM プロファイル選択
- 「標準」「コスト節約」「精度重視」などの意味
- どのプロファイルを選べばよいかの目安
- プロファイルは管理者が定義していることの説明

### 5.4 初回オンボーディングツアーの再表示
- 初回に表示されたチュートリアルを、設定画面から再度表示できる
- 「二度と表示しない」を解除する方法（設定フラグ）

---

## 6. 回答フィードバック（👍/👎 + コメント）

### 6.1 なぜフィードバックが重要か
- モデル・エージェントの改善に直接つながる
- 自分の組織向けに精度を上げるための材料

### 6.2 フィードバックの付け方
- 各回答にある 👍 / 👎 ボタンの位置
- コメント欄に書くときのポイント
  - 何が良かったか/悪かったか
  - 足りなかった情報や誤り

### 6.3 フィードバックがどのように使われるか
- AgentOps ログに蓄積される
- 将来的に改善タスク・評価レポートに利用される

---

## 7. ナレッジ管理（管理者向け）

### 7.1 ナレッジ一覧画面
- 一覧で見られる情報:
  - タイトル / 元ファイル名 / 言語 / サイズ / 登録者 / 日付 / ソース種別
- ページネーションとソートの使い方

### 7.2 ナレッジ検索
- キーワード検索（タイトル・ファイル名）
- フィルタ（言語 / ソース種別 / 登録者 / 日付）

### 7.3 ナレッジ詳細とテキストプレビュー
- 抽出テキストの確認方法
- 文字化けやおかしな分割がないかのチェックポイント

### 7.4 将来機能: 削除・バージョン管理
- ソフトデリート（無効化）のイメージ
- バージョン（v1, v2, ...）の考え方
- 誤登録や古い情報への対応方針

---

## 8. よくある質問 (FAQ) とトラブルシューティング

### 8.1 チャット・回答まわり
- Q: 応答が返ってこない / 遅い  
  - ネットワーク確認 / 再読込 / サーバ状況 / 管理者への連絡
- Q: 変な答えが返ってきた  
  - 追加情報を与える / フィードバックで👎を押す / 質問の聞き方を具体的にする
- Q: リサーチモードにしたら遅く感じる  
  - 複数ステップで調査しているため、通常より時間がかかることがある  
  - すぐに結果が欲しい場合は、リサーチモードを OFF にして質問し直す

### 8.2 ファイルアップロード
- Q: ファイルがアップロードできない  
  - 拡張子・サイズ・個数制限の確認
- Q: PDF の日本語がうまく読まれていない  
  - スキャンPDF / 画像PDF の可能性（PoC では対応外）

### 8.3 メモリ・Reset
- Q: `/reset` を押したら会話が消えた？  
  - 新しいセッションに切り替わっただけで、前の会話はメモリに残っている可能性がある  
  - メモリ画面から該当セッションの要約を探す
- Q: 過去の決定事項が見つからない  
  - メモリ検索のキーワードを変えてみる  
  - 保存時に「保存して終了」を選んだか確認

### 8.4 設定・ヘルプ
- Q: 文字が小さくて読みにくい  
  - 設定画面からフォントサイズを「大」に変更
- Q: 英語 UI に切り替えたい  
  - 設定画面の言語設定から「English」を選択
- Q: チュートリアルをもう一度見たい  
  - 設定画面で「オンボーディングツアーを再表示」を選ぶ

---

## 9. セキュリティ・プライバシーに関する注意

### 9.1 入力してよい情報・ダメな情報
- 社内規定に従った情報の取り扱い
- 個人情報・機密情報は、必要最小限に留める
- 明らかに社外に出してはいけない情報は入力しない（PoC では特に注意）

### 9.2 ログ・メモリ・ナレッジの扱い
- どの情報が保存されるか（チャット / ナレッジ / メモリ）
- 誰が閲覧できるか（ユーザー本人 / 管理者）
- フィードバックや AgentOps ログは品質改善のために利用されること

### 9.3 問題が発生したときの連絡経路
- 管理者・運用チームへの連絡方法
- 障害時の基本的な動き（告知 / 復旧）

---

## 10. 管理者向けヘルプ（概要）

### 10.1 テナント設定
- LLM プロバイダ / RAG / Web / メモリ保持期間の意味
- LLM プロファイル設計の考え方（標準 / コスト / 精度）

### 10.2 ログ・AgentOps の見方
- `agent_runs` / `feedback_events` をどう読むか
- エラー率・レイテンシ・トークン数の基礎

### 10.3 ポリシー変更・アップデート時の注意
- プロンプト・ポリシー変更が回答にどう影響するか
- モデルアップデートの前に行うべきテスト
- PoC 期間中は、大きな変更前に必ずテスト用テナントで試すこと
