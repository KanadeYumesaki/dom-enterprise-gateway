了解です、それいいメモですね。
「どこがあなたの判断で、どこがAIの設計支援か」を分けておくと、後続のAIにも人間にもかなり親切です。

そのまま別スレでも貼って使えるように、**機能・要素ごとに「人間が決めた」「AIが構造化・具体化した」**を整理します。

---

# Prism v2 / PoC

人間とAIの担当範囲メモ v1.0

> ✅ 別スレのAIに伝えるときは、
> 「このメモの『人間が決めた』部分は基本前提として扱ってください」
> と添えておくと安全です。

---

## 1. コンセプト・プロダクトの方向性

| 要素                | 人間が決めたこと                                                                        | AIがやったこと                                                  |
| ----------------- | ------------------------------------------------------------------------------- | --------------------------------------------------------- |
| プロダクトの目的          | エンタープライズ向けの「ガバナンス付き LLM ゲートウェイ」/ エージェント・RAG・メモリを一体化して、人間っぽい長期的な文脈保持と説明責任を両立させたい | 目的を「Prism Enterprise AI v2」として文書化し、PoC〜本番のフェーズ構造に落とした     |
| 対象ユーザー            | 初心者ではなく、現場の開発者・コンサル・高度ユーザー寄りにしたい                                                | ターゲットを設計書の前提に反映（UIや説明の粒度の前提として利用）                         |
| 「最先端を取り込みたい」という方針 | 2023〜2025 の長期メモリ・マルチエージェント・Agentic RAG などの研究を前提として設計に反映したい                      | 2025 近辺の研究トレンドを踏まえて、階層メモリ・Agentic RAG・PSI世界モデル風の構造として整理した |

---

## 2. モデル戦略（LLMの使い分け）

| 要素           | 人間が決めたこと                                                                   | AIがやったこと                                                            |
| ------------ | -------------------------------------------------------------------------- | ------------------------------------------------------------------- |
| メインLLM       | 本番は「安全な Gemini / ChatGPT / Claude など」をメインにする                               | メインLLMを MainLlmClient として抽象化し、プロバイダ切替可能な設計にまとめた                     |
| DeepSeek の扱い | DeepSeek は中国法のリスクを考慮し、「公式APIを本番の中核には使わない」。**小さいモデルをローカルで補助役として使う**方向で検討したい | 補助役の具体タスク（要約・RAGクエリ展開・タグ付けなど）を整理し、HelperLlmClient として役割を定義          |
| PoC でのモデル    | PoC の段階では「Gemini 無料枠」でやる（個人開発想定）。本番を見据えてアーキだけ汎用化しておきたい                     | PoC では Main/Helper とも Gemini を使い、別途 LlmClient 抽象で本番への差し替えを想定する構造を提案 |

---

## 3. メモリ設計（短期・長期・一時）

| 要素         | 人間が決めたこと                                                             | AIがやったこと                                                                                 |
| ---------- | -------------------------------------------------------------------- | ---------------------------------------------------------------------------------------- |
| 保存タイミング    | **セッションが終わるタイミングでのみ保存**したい（ログアウト or 終了操作）。タイムアウトや中途半端な状態では「一時記憶」に留める | セッション終了フロー（保存して終了／保存せず終了）と、一時記憶（Ephemeral Session Store）の役割分離として仕様化                      |
| 保存内容       | そのセッションの「要約」「必要なこと」「決まった指示」だけ覚えておきたい。全部生で残したくはない                     | EpisodicMemory のスキーマ（summary_text, importance, topic_tags など）に落とし、LangChain 要約チェーンを前提に設計 |
| メモリの扱い方    | 過去メモリは「絶対の真実」ではなく**メモとして扱い、推論時は候補を出してユーザーに含めるか確認したい**                | 「過去メモ候補を提示 → 今回含めるかどうか選択する」UI/フローをFRとして明文化し、メモリを“主観的要約”前提で扱う仕様にした                        |
| RESET ポリシー | 短期記憶を捨てる前に、必ず長期記憶に要約を残す（失敗したら reset しない）。「忘れる前に日記を書く」インバリアントを守りたい    | RESET インバリアント（保存成功しない限り短期記憶を消さない）を仕様（FR-RESET）に落とし、フローを定義                                |

---

## 4. セキュリティ / PII / 暗号化

| 要素     | 人間が決めたこと                                                     | AIがやったこと                                                                                                    |
| ------ | ------------------------------------------------------------ | ----------------------------------------------------------------------------------------------------------- |
| 暗号化方針  | **保存されるものは基本すべて暗号化必須**としたい（ログ・メモリ・RAGソースなど）                  | 「保存される全データ At-Rest 暗号化必須」をNFRとして明文化し、関係テーブル全体を対象に含める設計にした                                                   |
| PII 処理 | LLM の前で一度 PII/機密を処理し、その後バックエンドの LangChain でも実施したい（2段構えを前提）   | 共通 PII Service + policy_profile（internal_rag_indexing / external_web など）の設計案を作り、両段階で同じエンジンを使いつつポリシーを変える形を提案 |
| 中国法リスク | DeepSeek 公式API経由でデータを外に出すのは怖いので、本番中核には使わず、小モデルをローカルで回す方向にしたい | 公式API利用のリスクを整理し、「オープンウェイト自前ホストであればデータは外に出ない」運用案とコスト感を説明、PoC／本番の役割分担に反映                                      |

---

## 5. ガバナンス / Explainability / 管理画面

| 要素      | 人間が決めたこと                                                                         | AIがやったこと                                                                                    |
| ------- | -------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------- |
| ソース表示   | **回答のソースは必須**。ユーザーにはどのソースから引いたかを見せたい                                             | ソース種別（RAG/Web/Memory/Assumption）＋ID/URLを含む Explanation Object として構造化し、ユーザー向け/管理者向けの2段階表示を設計 |
| 管理者の可視性 | 管理者は「参考URL・中間の検討・協議」まで見えるようにして、ガバナンスを担保したい                                       | Explanation Object に、マルチエージェント協議のサマリや使ったソースの一覧を持たせ、管理者ビューでトレースできる設計にした                      |
| ガバナンス設定 | モデル選択や外部WebのON/OFFなどは**管理画面で変更できるイメージ**だが、プラットフォームの安全ガードなどは法務承認がないと触れないものとして扱いたい | 「プラットフォーム側で固定するガード」と「テナント管理者が変えられる設定」を分離し、ポリシー変更のワークフローはP2以降に回す、という現実ラインを整理                 |

---

## 6. マルチエージェント / AutoGen 構成

| 要素             | 人間が決めたこと                                                      | AIがやったこと                                                                                                 |
| -------------- | ------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------- |
| マイスター構成の基本イメージ | 「ドメインオーケストラマイスター」がいて、質問や指示を要素ごとに分解し、適切なマイスターを割り振って協議させたいイメージ  | DOM / Helper / Research / Answer を最小構成のエージェントとして定義し、役割とデータフロー（誰が何を受け取り、何を返すか）を整理                         |
| PSI 的な自己改善     | スタンフォードの PSI のような「予測 →構造抽出→統合」のサイクルを、テキスト・ログベースの世界モデルとして活かしたい | PSI を Prism 用にマッピング：Prediction Meister / Structure Meister / Integration Meister の3段階ループとして設計（PoCではライト版） |
| MCP について       | MCP は常時使うとコンテキストを食う・リスクもあるので「保留」にしたい                          | MCP を「将来のツール接続レイヤ」として扱い、現時点ではツール呼び出しをラップするGatekeeperだけ考える、という落としどころを提示                                   |

---

## 7. PoC スコープ・フェーズ設計

| 要素        | 人間が決めたこと                                              | AIがやったこと                                                         |
| --------- | ----------------------------------------------------- | ---------------------------------------------------------------- |
| PoC の位置づけ | v1 はあくまで PoC として、「現実ラインでどこまでできるか」を見たい。本番機能全部は求めない     | 機能を P0（PoC）/P1（本番）/P2（高度化）に分け、どこまでを PoC で実装するかを振り分けた             |
| モデル運用     | PoC は Gemini 無料枠内で収める。本番では DeepSeek 小モデル＋商用LLM 前提で考える | LlmClient 抽象化、Main/Helper の分離、本番移行時に差し替え前提の構造を設計                 |
| 「重さ」の判断   | 「全部盛りにすると1プロダクト分の重さになるので、PoCでは絞りたい」という意識              | どの機能が本当に重いか（トレースUI・ポリシーワークフロー・フル多エージェントなど）を率直に評価し、PoC対象から外す提案をした |

---

## 8. コスト・運用の考え方

| 要素                 | 人間が決めたこと                                                        | AIがやったこと                                                         |
| ------------------ | --------------------------------------------------------------- | ---------------------------------------------------------------- |
| DeepSeek 小モデルの稼働時間 | 営業時間（9〜18時）のみ、平日20日前後で運用するイメージ                                  | その前提から、月180時間稼働で GPU コストがだいたい 50〜100ドル/月レンジになる試算を提示              |
| PoCコスト             | PoC は Gemini 無料枠で抑えたい。実質は「トークン量ログを取りながら構造を試す」用途                 | PoC 中も LLM トークン使用量を記録し、本番時のコスト見積もりに使うべき、とNFRに落とし込んだ              |
| 本番コストの現実性          | DeepSeek フルサイズを自前ホストするのは「月数百万円クラス」で現実的でないので、小モデル補助役＋商用LLMメインが良い | Northflank 等の公開情報をもとに、フルサイズ運用のコスト感を整理し、「小モデル補助＋商用LLM」が妥当という結論を補強 |

---

## 9. テーブル設計 / 画面イメージ

| 要素          | 人間が決めたこと                                              | AIがやったこと                                                                                                                                                            |
| ----------- | ----------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| どのデータを持ちたいか | 長期メモリ（Structured/Episodic）/監査ログ/テナント設定/ナレッジ/RAGなどの必要性 | `tenants`, `users`, `chat_sessions`, `chat_messages`, `structured_memory`, `episodic_memory`, `tenant_settings`, `explanation_objects`, `audit_logs` などのテーブルたたき台を設計 |
| 画面の方向性      | チャット画面＋管理画面が必要、メモリ閲覧も将来ほしい                            | チャット画面・セッション終了UI・過去メモ候補ダイアログ・管理画面（テナント設定＋監査ログ）の構成をざっくり設計                                                                                                            |

---

## 10. 別スレAIへの一言メモ

> * このメモの **「人間が決めたこと」** は、基本的に前提として尊重してほしい（特に：メモリの扱い方、暗号化必須、PoCのモデル運用方針など）。
> * **「AIがやったこと」** の部分は、設計の草案・整理であり、必要なら改善・変更してOK（ただし変更理由を簡単に説明してほしい）。
> * Prism v2 は「エンタープライズ向けガバナンス付き LLMゲートウェイ」であり、**安全性・説明責任・メモリ設計**が中核のテーマ。

---

このメモを新しいスレッドの一番上に貼っておけば、
他のAIや将来の自分が「どこまでがあなたの意思決定で、どこから先がAI設計なのか」をすぐ把握できるはずです。

もし、特に「ここだけは絶対に変えてほしくない」という項目があれば、
そこだけ別途「変更NGリスト」として短く作ることもできますよ。
